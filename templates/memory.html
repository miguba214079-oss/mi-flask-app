<!DOCTYPE html>
<!-- Indica que este documento usa HTML5 -->

<html lang="en">
<!-- Define el idioma del documento -->

<head>
    <meta charset="UTF-8">
    <!-- Permite usar caracteres especiales como tildes, emojis, etc. -->

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Hace que la p√°gina sea responsiva en dispositivos m√≥viles -->

    <title>Document</title>
    <!-- T√≠tulo por defecto (luego ser√° reemplazado por el bloque title) -->
</head>

<body>

    {% extends 'base.html' %}
    <!-- La plantilla hereda el dise√±o, estilos y navbar de base.html -->

    {% block title %}Juego de Memoria{% endblock %}
    <!-- T√≠tulo que aparece en la pesta√±a del navegador -->

    {% block content %}
    <!-- Aqu√≠ empieza el contenido principal -->

<h2 class="mb-3 text-center">Juego de Memoria</h2>
<!-- T√≠tulo centrado con margen inferior -->

<p class="text-center">
    Encuentra los pares de cartas iguales. Haz clic para voltear las cartas.
</p>
<!-- Texto que explica c√≥mo jugar -->

<!-- Tablero responsivo: usa Bootstrap para que las cartas se acomoden solas -->
<div id="gameBoard" class="row row-cols-2 row-cols-sm-4 g-3 justify-content-center"></div>

<!-- Mensaje del estado del juego (ganaste, sigue jugando, etc.) -->
<p id="message" class="mt-3 text-center fs-5 fw-semibold"></p>

<!-- Bot√≥n para reiniciar -->
<div class="text-center">
    <button id="restartBtn" class="btn btn-warning mt-3 px-4 fw-bold">
        Reiniciar Juego
    </button>
</div>

<script>
/* -------------------------------------------------------------------------
   VARIABLES DEL JUEGO
   ------------------------------------------------------------------------- */

// Arreglo de emojis: cada carta aparece dos veces
const cardsArray = ['üçé','üçå','üçá','üçâ','üçé','üçå','üçá','üçâ'];

// Arreglo donde se guardar√° la baraja mezclada
let shuffledCards = [];

// Variables para controlar el primer y segundo clic del jugador
let firstCard = null;
let secondCard = null;

// Evita que se pueda hacer clic mientras se verifican dos cartas
let lockBoard = false;

// Contador de pares encontrados
let matches = 0;

// Elementos del DOM
const gameBoard = document.getElementById('gameBoard');
const message = document.getElementById('message');
const restartBtn = document.getElementById('restartBtn');


/* -------------------------------------------------------------------------
   FUNCI√ìN PARA MEZCLAR CARTAS (Fisher‚ÄìYates shuffle)
   ------------------------------------------------------------------------- */
function shuffle(array) {
    let currentIndex = array.length, temporaryValue, randomIndex;

    while (currentIndex !== 0) {
        // Escoge un √≠ndice aleatorio
        randomIndex = Math.floor(Math.random() * currentIndex);
        currentIndex--;

        // Intercambia valores
        temporaryValue = array[currentIndex];
        array[currentIndex] = array[randomIndex];
        array[randomIndex] = temporaryValue;
    }
    return array;
}


/* -------------------------------------------------------------------------
   FUNCION PARA CREAR EL TABLERO
   ------------------------------------------------------------------------- */
function createBoard() {
    gameBoard.innerHTML = ''; // Limpia tablero anterior
    shuffledCards = shuffle(cardsArray.slice()); // Crea copia mezclada
    matches = 0; // Reinicia contador
    message.textContent = ''; // Limpia mensaje
    firstCard = null;
    secondCard = null;
    lockBoard = false;

    // Crea una carta visual por cada emoji
    shuffledCards.forEach((emoji, index) => {
        const card = document.createElement('div');

        // Clases visuales de Bootstrap
        card.classList.add('card', 'text-center', 'shadow-sm', 'p-4', 'rounded', 'bg-gradient');
        card.style.cursor = 'pointer';
        card.style.fontSize = '3rem';

        // Guarda informaci√≥n en atributos
        card.dataset.emoji = emoji; 
        card.dataset.index = index;

        // El contenido inicial es un signo de pregunta
        card.textContent = '‚ùì';

        // Evento cuando el jugador hace clic
        card.addEventListener('click', flipCard);

        // Agrega la carta al tablero
        gameBoard.appendChild(card);
    });
}


/* -------------------------------------------------------------------------
   L√ìGICA PRINCIPAL: VOLTEAR CARTAS
   ------------------------------------------------------------------------- */
function flipCard(e) {
    if (lockBoard) return; // Evita doble clic si hay dos cartas abiertas

    const clickedCard = e.currentTarget;

    if (clickedCard === firstCard) return; // No permite seleccionar dos veces la misma carta

    // Muestra el emoji (voltea la carta)
    clickedCard.textContent = clickedCard.dataset.emoji;

    // Si no hay primera carta todav√≠a, esta es la primera
    if (!firstCard) {
        firstCard = clickedCard;
        return;
    }

    // Segunda carta seleccionada
    secondCard = clickedCard;
    lockBoard = true;

    // Si los emojis coinciden ‚Üí par encontrado
    if (firstCard.dataset.emoji === secondCard.dataset.emoji) {
        matches++;

        // Colorea ambas cartas de verde para indicar acierto
        firstCard.style.background = '#28a745';
        firstCard.style.color = 'white';
        secondCard.style.background = '#28a745';
        secondCard.style.color = 'white';

        resetTurn();

        // Si encontraste todos los pares ‚Üí ganaste
        if (matches === cardsArray.length / 2) {
            message.textContent = '¬°Felicidades! Has encontrado todos los pares üéâ';
            message.style.color = '#ffc107';
        }

    } else {
        // Si NO coinciden ‚Üí se voltean despu√©s de 1 segundo
        setTimeout(() => {
            firstCard.textContent = '‚ùì';
            secondCard.textContent = '‚ùì';

            firstCard.style.background = '';
            secondCard.style.background = '';
            firstCard.style.color = '';
            secondCard.style.color = '';

            resetTurn();
        }, 1000);
    }
}


/* -------------------------------------------------------------------------
   REINICIA LA SELECCI√ìN DE CARTAS
   ------------------------------------------------------------------------- */
function resetTurn() {
    [firstCard, secondCard] = [null, null]; // Limpia variables
    lockBoard = false; // Libera el tablero
}


/* -------------------------------------------------------------------------
   EVENTO PARA REINICIAR JUEGO
   ------------------------------------------------------------------------- */
restartBtn.addEventListener('click', createBoard);


/* -------------------------------------------------------------------------
   INICIALIZA EL JUEGO CUANDO CARGA LA P√ÅGINA
   ------------------------------------------------------------------------- */
createBoard();
</script>

<style>
  /* Fondo degradado pastel para las cartas */
  .bg-gradient {
    background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%);
    transition: background-color 0.3s ease;
  }

  /* Efecto al pasar el mouse */
  .bg-gradient:hover {
    background: linear-gradient(135deg, #a18cd1 0%, #fbc2eb 100%);
  }
</style>

<!-- Bot√≥n para regresar al men√∫ de juegos -->
<a href="{{ url_for('games') }}" class="btn btn-outline-warning mt-4 d-block mx-auto w-auto">
    Volver a Juegos
</a>

{% endblock %}
<!-- Fin del bloque de contenido -->

</body>
</html>
